rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Базові правила для всіх колекцій
    match /{document=**} {
      allow read, write: if false;
    }
    
    // Правила для колекції відгуків
    match /reviews/{reviewId} {
      // Дозволяємо читати тільки схвалені відгуки для всіх користувачів
      // або всі відгуки для адміністраторів
      allow read: if 
        (resource.data.status == 'approved') || 
        (request.auth != null && request.auth.token.admin == true);
      
      // Дозволяємо створювати нові відгуки всім користувачам
      // але з певними обмеженнями на поля
      allow create: if 
        request.resource.data.name is string && 
        request.resource.data.email is string && 
        request.resource.data.comment is string && 
        request.resource.data.rating is number && 
        request.resource.data.rating >= 1 && 
        request.resource.data.rating <= 5 &&
        // За замовчуванням статус "очікує модерації"
        request.resource.data.status == 'pending';
      
      // Дозволяємо оновлювати та видаляти відгуки тільки адміністраторам
      allow update, delete: if request.auth != null && request.auth.token.admin == true;
    }
    
    // Правила для інших колекцій можна додати тут
  }
}
